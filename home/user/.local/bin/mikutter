#!/bin/bash
set -eu

cd ~/Desktop/mikutter/

# WSL環境でだけ設定する項目。
if grep -q "WSL" "/proc/sys/kernel/osrelease"; then
  # mikutter専用にfcitxを使います。
  export GTK_IM_MODULE=fcitx
  export QT_IM_MODULE=fcitx
  export XMODIFIERS=@im=fcitx
  export DefaultIMModule=fcitx
  fcitx-autostart > /dev/null 2>&1

  # Waylandネイティブで起動すると、
  # ウィンドウ最大化するとまともにUIが動かない。
  # キーボードをDvorak設定にする方法が分からない。
  # という問題が発生するため、
  # XWayland経由で起動する。
  export GDK_BACKEND=x11

  # .Xresourcesを自動的に読み込んでくれないのでここで読み込んでしまいます。
  # mikutterとEmacs以外にGUIアプリを使わず、
  # Emacsの方はHi-DPIを自前で検出しているのか通常利用可能なので問題ありません。
  xrdb -merge ~/.Xresources
fi

exec ./mikutter.rb "$@"
